#! /bin/sh -e
if [ $# -ne 1 ]; then 
    echo >&2 "`basename $0`: script expects -patch|-unpatch as argument"
    exit 1  
fi
case "$1" in 
    -patch) patch -f --no-backup-if-mismatch -p1 < $0;;
    -unpatch) patch -f --no-backup-if-mismatch -R -p1 < $0;;
    *)
        echo >&2 "`basename $0`: script expects -patch|-unpatch as argument"
        exit 1;;
esac

exit 0

@DPATCH@
Index: nullmailer-1.05/lib/hostname.cc
===================================================================
--- nullmailer-1.05.orig/lib/hostname.cc	2011-04-05 13:39:52.000000000 +0100
+++ nullmailer-1.05/lib/hostname.cc	2011-04-05 13:41:52.000000000 +0100
@@ -33,7 +33,9 @@
 {
   int nome;
   nome = 0;
-  if (!config_read("me", me)) {
+  // introduced as bufix for #120660, #157259, #158412 in 1.00RC5-17;
+  // still there since it's more appropriate for Debian systems
+  if (!config_read("../mailname", me)) {
     nome = 1;
     me = "me";
   }
Index: nullmailer-1.05/doc/nullmailer-send.8
===================================================================
--- nullmailer-1.05.orig/doc/nullmailer-send.8	2011-04-05 13:39:52.000000000 +0100
+++ nullmailer-1.05/doc/nullmailer-send.8	2011-04-05 13:41:52.000000000 +0100
@@ -71,14 +71,14 @@
 which also requires SMTP authentication, use:
 
 .EX
-    smarthost.dom smtp --port=2525 --user=user --pass=pass
+    smarthost.dom smtp \-\-port=2525 \-\-user=user \-\-pass=pass
 .EE
 
 If your smarthost requires LOGIN authentication instead of the default
 PLAIN method, use:
 
 .EX
-    smarthost.dom smtp --port=2525 --auth-login --user=user --pass=pass
+    smarthost.dom smtp \-\-port=2525 \-\-auth-login \-\-user=user \-\-pass=pass
 .EE
 
 Blank lines and lines starting with a pound are ignored.
@@ -94,16 +94,16 @@
 will wait forever for messages to complete sending.
 .SH FILES
 .TP
-.B /var/nullmailer/queue
+.B /var/spool/nullmailer/queue
 The message queue.
 .TP
-.B /var/nullmailer/trigger
+.B /var/spool/nullmailer/trigger
 A trigger file to cause immediate delivery.
 .TP
-.B /usr/local/etc/nullmailer
+.B /etc/nullmailer
 The configuration directory.
 .TP
-.B /usr/local/libexec/nullmailer
+.B /usr/lib/nullmailer
 The protocol program directory.
 .SH SEE ALSO
 nullmailer-queue(8),
Index: nullmailer-1.05/doc/nullmailer-queue.8
===================================================================
--- nullmailer-1.05.orig/doc/nullmailer-queue.8	2011-04-05 13:39:52.000000000 +0100
+++ nullmailer-1.05/doc/nullmailer-queue.8	2011-04-05 13:41:52.000000000 +0100
@@ -22,21 +22,21 @@
 .TP
 .B adminaddr
 If this file is not empty, all recipients to users at either
-"localhost" (the literal string) or the canonical host name (from the
-.I me
-control file) are remapped to this address.
+"localhost" (the literal string) or the canonical host name (from
+.IR /etc/mailname )
+are remapped to this address.
 This is provided to allow local daemons to be able to send email to
 "somebody@localhost" and have it go somewhere sensible instead of
 being bounced by your relay host.
 .SH OTHER FILES
 .TP
-.B /var/nullmailer/queue
+.B /var/spool/nullmailer/queue
 The directory into which the completed messages are moved.
 .TP
-.B /var/nullmailer/tmp
+.B /var/spool/nullmailer/tmp
 The directory in which messages are formed temporarily.
 .TP
-.B /var/nullmailer/trigger
+.B /var/spool/nullmailer/trigger
 A pipe used to trigger
 .BR nullmailer-send
 to immediately start sending the message from the queue.
Index: nullmailer-1.05/doc/nullmailer-inject.1
===================================================================
--- nullmailer-1.05.orig/doc/nullmailer-inject.1	2011-04-05 13:39:52.000000000 +0100
+++ nullmailer-1.05/doc/nullmailer-inject.1	2011-04-05 13:42:10.000000000 +0100
@@ -82,7 +82,7 @@
 Address lists are expected to follow the syntax set out in RFC822.
 The following is a simplified explanation of the syntax.
 
-An address list is list of addresses seperated by commas.
+An address list is list of addresses separated by commas.
 An individual address may have one of the following three forms:
 .IR user@fqdn ,
 .IR comment <user@fqdn> ,
@@ -227,16 +227,16 @@
 and
 .BR idhost .
 Defaults to the value of the
-.I me
-control file, if it exists, otherwise the literal name
+.I /etc/mailname
+system file, if it exists, otherwise the literal name
 .IR defauldomain .
 .TP
 .B defaulthost
 The content of this file is appended to any address that is missing a
 host name.
 Defaults to the value of the
-.I me
-control file, if it exists, otherwise the literal name
+.I /etc/mailname
+system file, if it exists, otherwise the literal name
 .IR defaulthost .
 .TP
 .B idhost
@@ -245,7 +245,7 @@
 Defaults to the canonicalized value of
 .BR defaulthost .
 .TP
-.B me
+.B /etc/mailname
 The fully-qualifiled host name of the computer running nullmailer.
 Defaults to the literal name
 .IR me .
Index: nullmailer-1.05/doc/sendmail.1
===================================================================
--- nullmailer-1.05.orig/doc/sendmail.1	2011-04-05 13:39:52.000000000 +0100
+++ nullmailer-1.05/doc/sendmail.1	2011-04-05 13:41:52.000000000 +0100
@@ -67,7 +67,7 @@
 Sets the envelope sender address.
 .TP
 .B \-r ADDRESS
-An alternate and obsolete form of the -f flag.
+An alternate and obsolete form of the \-f flag.
 .TP
 .B \-t
 Read message for recipients and ignore the command-line arguments.
